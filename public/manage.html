<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin</title>
<style>
body{font-family:sans-serif;}
label{display:block;margin-top:10px;}
</style>
</head>
<body>
<h1>Admin</h1>
<div>
<label>Nome do time azul <input id="teamBlue"/></label>
<label>Nome do time amarelo <input id="teamYellow"/></label>
<button onclick="saveTeams()">Salvar</button>
</div>
<hr>
<div>
<h2>Cadastrar jogador</h2>
<label>Nome <input id="playerName"/></label>
<select id="playerTeam"><option value="blue">Azul</option><option value="yellow">Amarelo</option></select>
<button onclick="addPlayer()">Adicionar</button>
</div>
<hr>
<div>
<h2>Touro Mecanico</h2>
<label>Jogador <input id="bullPlayer" list="players"/></label>
<label>Tempo <input id="bullTime" type="number"/></label>
<button onclick="addBull()">Registrar</button>
</div>
<hr>
<div>
<h2>Guerra de Cotonete</h2>
<label>P1 <input id="cottonP1" list="players"/></label>
<label>P2 <input id="cottonP2" list="players"/></label>
<label>Vencedor <input id="cottonWin" list="players"/></label>
<button onclick="addCotton()">Registrar</button>
</div>
<hr>
<div>
<h2>Beer Pong</h2>
<label>Jogador1 (Time Azul) <input id="beerBlueP1" list="playersBlue"/></label>
<label>Jogador2 (Time Azul) <input id="beerBlueP2" list="playersBlue"/></label>
<label>Jogador1 (Time Amarelo) <input id="beerYellowP1" list="playersYellow"/></label>
<label>Jogador2 (Time Amarelo) <input id="beerYellowP2" list="playersYellow"/></label>
<label>Vencedor <select id="beerWin"></select></label>
<button onclick="addBeer()">Registrar</button>
</div>
<hr>
<div>
<h2>Pacal</h2>
<label>P1 <input id="pacalP1" list="players"/></label>
<label>P2 <input id="pacalP2" list="players"/></label>
<label>Vencedor <input id="pacalWin" list="players"/></label>
<button onclick="addPacal()">Registrar</button>
</div>
<hr>
<div>
<h2>Bingo</h2>
<label>1¬∫ <input id="bingo1" list="players"/></label>
<label>2¬∫ <input id="bingo2" list="players"/></label>
<label>3¬∫ <input id="bingo3" list="players"/></label>
<button onclick="addBingo()">Registrar</button>
</div>
<hr>
<div>
<h2>Atra√ß√£o</h2>
<label>Horario (YYYY-MM-DDTHH:MM:SS) <input id="attrTime"/></label>
<label>Nome <input id="attrName"/></label>
<button onclick="addAttraction()">Adicionar</button>
</div>
<hr>
<button onclick="resetAll()">Zerar Tudo</button>
<hr>
<div>
<h2>Placar</h2>
<ul id="scoreBoard"></ul>
</div>
<datalist id="players"></datalist>
<datalist id="playersBlue"></datalist>
<datalist id="playersYellow"></datalist>
<script>
function post(url,data){fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});}
let players = {};
let teamNames={blue:'Azul',yellow:'Amarelo'};
function loadPlayers(){fetch('/api/players').then(r=>r.json()).then(p=>{players=p;updateDatalist();});}
function updateDatalist(){
  playersElem.innerHTML=Object.keys(players).map(n=>`<option value="${n}">`).join('');
  playersBlueElem.innerHTML=Object.keys(players).filter(n=>players[n]==='blue').map(n=>`<option value="${n}">`).join('');
  playersYellowElem.innerHTML=Object.keys(players).filter(n=>players[n]==='yellow').map(n=>`<option value="${n}">`).join('');
}
function loadTeams(){fetch('/api/state').then(r=>r.json()).then(s=>{teamNames=s.teamNames;beerWin.innerHTML=`<option value="blue">${teamNames.blue}</option><option value="yellow">${teamNames.yellow}</option>`;});}
function ensurePlayer(name,teamHint){if(!name||players[name])return;const team=teamHint||prompt(`Time para ${name}? (blue/yellow)`);if(team){post('/api/player',{name,team});players[name]=team;updateDatalist();}}
function saveTeams(){post('/api/config/teamNames',{blue:teamBlue.value,yellow:teamYellow.value});}
function addPlayer(){post('/api/player',{name:playerName.value,team:playerTeam.value});players[playerName.value]=playerTeam.value;updateDatalist();}
function addBull(){ensurePlayer(bullPlayer.value);post('/api/bull',{name:bullPlayer.value,time:bullTime.value});}
function addCotton(){[cottonP1.value,cottonP2.value,cottonWin.value].forEach(ensurePlayer);post('/api/cotton',{p1:cottonP1.value,p2:cottonP2.value,winner:cottonWin.value});}
function addBeer(){
  [beerBlueP1.value,beerBlueP2.value].forEach(n=>ensurePlayer(n,'blue'));
  [beerYellowP1.value,beerYellowP2.value].forEach(n=>ensurePlayer(n,'yellow'));
  post('/api/beer',{
    team1:[beerBlueP1.value,beerBlueP2.value],
    team2:[beerYellowP1.value,beerYellowP2.value],
    winner:beerWin.value
  });
}
function addPacal(){[pacalP1.value,pacalP2.value,pacalWin.value].forEach(ensurePlayer);post('/api/pacal',{p1:pacalP1.value,p2:pacalP2.value,winner:pacalWin.value});}
function addBingo(){[bingo1.value,bingo2.value,bingo3.value].forEach(ensurePlayer);post('/api/bingo',{first:bingo1.value,second:bingo2.value,third:bingo3.value});}

function updateDatalist(){playersElem.innerHTML=Object.keys(players).map(n=>`<option value="${n}">`).join('');}
function askTeam(name){
  return new Promise(resolve=>{
    const overlay=document.createElement('div');
    Object.assign(overlay.style,{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center'});
    overlay.innerHTML=`<div style="background:white;padding:20px;text-align:center;">
        <p>Selecione o time para ${name}</p>
        <button id="chooseBlue">Azul</button>
        <button id="chooseYellow">Amarelo</button>
      </div>`;
    document.body.appendChild(overlay);
    overlay.querySelector('#chooseBlue').onclick=()=>{done('blue');};
    overlay.querySelector('#chooseYellow').onclick=()=>{done('yellow');};
    function done(team){document.body.removeChild(overlay);resolve(team);}
  });
}
async function ensurePlayer(name){
  if(!name||players[name])return;
  const team=await askTeam(name);
  if(team){post('/api/player',{name,team});players[name]=team;updateDatalist();}
}
function saveTeams(){post('/api/config/teamNames',{blue:teamBlue.value,yellow:teamYellow.value});}
function addPlayer(){post('/api/player',{name:playerName.value,team:playerTeam.value});players[playerName.value]=playerTeam.value;updateDatalist();}
async function addBull(){await ensurePlayer(bullPlayer.value);post('/api/bull',{name:bullPlayer.value,time:bullTime.value});}
async function addCotton(){for(const n of [cottonP1.value,cottonP2.value,cottonWin.value]) await ensurePlayer(n);post('/api/cotton',{p1:cottonP1.value,p2:cottonP2.value,winner:cottonWin.value});}
async function addBeer(){for(const n of [beerT1P1.value,beerT1P2.value,beerT2P1.value,beerT2P2.value,beerWin.value]) await ensurePlayer(n);post('/api/beer',{team1:[beerT1P1.value,beerT1P2.value],team2:[beerT2P1.value,beerT2P2.value],winner:beerWin.value});}
async function addPacal(){for(const n of [pacalP1.value,pacalP2.value,pacalWin.value]) await ensurePlayer(n);post('/api/pacal',{p1:pacalP1.value,p2:pacalP2.value,winner:pacalWin.value});}
async function addBingo(){for(const n of [bingo1.value,bingo2.value,bingo3.value]) await ensurePlayer(n);post('/api/bingo',{first:bingo1.value,second:bingo2.value,third:bingo3.value});}
function addAttraction(){post('/api/attraction',{time:attrTime.value,name:attrName.value});}
function resetAll(){post('/api/reset',{});}
const playersElem=document.getElementById('players');
const playersBlueElem=document.getElementById('playersBlue');
const playersYellowElem=document.getElementById('playersYellow');
loadPlayers();
loadTeams();
function loadScore(){
  fetch('/api/state').then(r=>r.json()).then(s=>{
    const ul=document.getElementById('scoreBoard');
    const entries=Object.entries(s.scores).sort((a,b)=>b[1]-a[1]);
    ul.innerHTML=entries.map(([team,score],i)=>`<li>${s.teamNames[team]} - ${score}${i===0?' üèÜ':''}</li>`).join('');
  });
}
loadScore();
setInterval(loadScore,5000);
</script>
</body>
</html>
