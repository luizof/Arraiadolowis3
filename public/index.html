<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slides</title>
<style>
body,html{margin:0;padding:0;height:100%;width:100%;font-family:sans-serif;color:white;text-align:center;}
.slide{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;padding:20px;}
.active{display:block;}
.team-blue{color:blue;}
.team-yellow{color:gold;}
/* Estilos para slide de atraÃ§Ãµes */
.attractions-slide{font-family:'Comic Sans MS','Comic Sans',cursive;font-weight:bold;}
.attractions-title{font-size:72px;}
.attractions-now-label{font-size:48px;}
.attractions-current{font-size:64px;}
.attractions-next-label{font-size:48px;text-align:center;}
.attractions-next{font-size:64px;}
.clock{font-size:48px;}
/* Estilos para slide de bingo */
.bingo-slide{font-family:'Comic Sans MS','Comic Sans',cursive;font-weight:bold;}
.bingo-title{font-size:72px;}
.bingo-table{margin:0 auto;border-collapse:collapse;width:100%;}
.bingo-table td{font-size:64px;padding:10px;}
</style>
</head>
<body>
<div id="slides"></div>
<script>
const slidesEl=document.getElementById('slides');
let state={};
const bgImages={
  bull:'backgrounds/bull.jpg',
  cotton:'backgrounds/cotton.jpg',
  bingo:'backgrounds/bingo.jpg',
  beer:'backgrounds/beer.jpg',
  pacal:'backgrounds/pacal.jpg',
  attractions:'backgrounds/attractions.jpg',
  score:'backgrounds/score.jpg'
};
function render(){
  slidesEl.innerHTML='';
  const slides=[];
    if(state.bullTimes.length>0){
      const keys=['bullFirst','bullSecond','bullThird','bullFourth','bullFifth'];
      const sorted=[...state.bullTimes].sort((a,b)=>a.time-b.time).slice(0,keys.length);
      let html='<h1>Top Touro</h1><ol>';let i=0;
      sorted.forEach(r=>{
        const k=keys[i];
        const pts=state.points[k]||0;
        html+=`<li><span class="team-${state.players[r.name]}">${r.name}</span> - ${r.time}s (${pts} pts) ${i==0?'ğŸ†':''}</li>`;
        i++;
      });
      html+='</ol>';
    slides.push({color:'darkred',image:bgImages.bull,html});
    }
  if(state.cottonWars.length>0){
    let html='<h1>Guerra de Cotonete</h1><ul>';
    state.cottonWars.slice(-5).forEach(b=>{html+=`<li><span class="team-${state.players[b.p1]}">${b.p1}</span> vs <span class="team-${state.players[b.p2]}">${b.p2}</span> ğŸ† <span class="team-${state.players[b.winner]}">${b.winner}</span></li>`});
    html+='</ul>';
    slides.push({color:'green',image:bgImages.cotton,html});
  }
  if(state.bingoWinners){
    let html='<div class="bingo-slide">';
    html+='<div class="bingo-title">Bingo</div>';
    html+='<table class="bingo-table">';
    const rows=[
      {name:state.bingoWinners.first,key:'bingoFirst',trophy:'ğŸ†',pos:'1Âº'},
      {name:state.bingoWinners.second,key:'bingoSecond',pos:'2Âº'},
      {name:state.bingoWinners.third,key:'bingoThird',pos:'3Âº'}
    ];
    rows.forEach(r=>{
      const pts=state.points[r.key]||0;
      html+=`<tr><td>${r.pos}</td><td><span class="team-${state.players[r.name]}">${r.name||''}</span> (${pts} pts) ${r.trophy||''}</td></tr>`;
    });
    html+='</table></div>';
    slides.push({color:'purple',image:bgImages.bingo,html});
  }
  if(state.beerPongs.length>0){
    let html='<h1>Beer Pong</h1><ul>';
    state.beerPongs.slice(-5).forEach(b=>{html+=`<li>${b.team1.map(p=>`<span class="team-${state.players[p]}">${p}</span>`).join(' & ')} vs ${b.team2.map(p=>`<span class="team-${state.players[p]}">${p}</span>`).join(' & ')} ğŸ† <span class="team-${b.winner}">${state.teamNames[b.winner]}</span></li>`});
    html+='</ul>';
    slides.push({color:'orange',image:bgImages.beer,html});
  }
  if(state.pacalWars.length>0){
    let html='<h1>Pacal</h1><ul>';
    state.pacalWars.slice(-5).forEach(b=>{html+=`<li><span class="team-${state.players[b.p1]}">${b.p1}</span> vs <span class="team-${state.players[b.p2]}">${b.p2}</span> ğŸ† <span class="team-${state.players[b.winner]}">${b.winner}</span></li>`});
    html+='</ul>';
    slides.push({color:'brown',image:bgImages.pacal,html});
  }
  if(state.attractions.length>0){
    const now=new Date();
    const current=state.attractions.find(a=> new Date(a.time)<=now);
    const next=state.attractions.find(a=> new Date(a.time)>now);
    let html='<div class="attractions-slide">';
    html+='<div class="attractions-title">AtraÃ§Ãµes</div>';
    if(current){
      html+=`<div class="attractions-now-label">Agora:</div>`;
      html+=`<div class="attractions-current">${current.name}</div>`;
    }
    if(next){
      const diff=Math.ceil((new Date(next.time)-now)/60000);
      html+=`<div class="attractions-next-label">Em seguida</div>`;
      html+=`<div class="attractions-next">${next.name} <span class="clock">ğŸ•’ ${diff} min</span></div>`;
    }
    html+='</div>';
    slides.push({color:'blue',image:bgImages.attractions,html});
  }
  const scoreEntries=Object.entries(state.scores).sort((a,b)=>b[1]-a[1]);
  let html='<h1>Placar</h1><ul>';
  scoreEntries.forEach(([team,score],i)=>{html+=`<li>${state.teamNames[team]} - ${score} ${i==0?'ğŸ†':''}</li>`});
  html+='</ul>';
  slides.push({color:'black',image:bgImages.score,html});

  slides.forEach((s,i)=>{
    const div=document.createElement('div');
    div.className='slide';
    if(s.color) div.style.backgroundColor=s.color;
    if(s.image) div.style.backgroundImage=`url('${s.image}')`;
    div.innerHTML=s.html;
    slidesEl.appendChild(div);
  });
  let idx=0;
  function show(){
    slidesEl.querySelectorAll('.slide').forEach((el,i)=>{el.classList.toggle('active',i===idx);});
    idx=(idx+1)%slidesEl.children.length;
  }
  if(slidesEl.children.length>0){show();setInterval(show,5000);}
}

const ws=new WebSocket(`ws://${location.host}`);
ws.onmessage=e=>{state=JSON.parse(e.data);render();};
</script>
</body>
</html>
