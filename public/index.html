<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slides</title>
<style>
body,html{margin:0;padding:0;height:100%;width:100%;font-family:sans-serif;color:white;text-align:center;}
.slide{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;padding:20px;}
.active{display:block;}
.team-blue{color:blue;}
.team-yellow{color:gold;}
/* Estilos para slide de atra√ß√µes */
.attractions-slide{font-family:'Comic Sans MS','Comic Sans',cursive;font-weight:bold;}
.attractions-title{font-size:90px;}
.attractions-now-label{font-size:60px;}
.attractions-current{font-size:80px;}
.attractions-next-label{font-size:60px;text-align:center;}
.attractions-next{font-size:80px;}
.clock{font-size:60px;}
/* Estilos para slide de guerra de cotonete */
.cotton-slide{font-family:'Comic Sans MS','Comic Sans',cursive;font-weight:bold;}
.cotton-slide h1{font-size:72px;margin-top:0;}
.cotton-row{font-size:48px;display:flex;align-items:baseline;padding:5px 20px;}
.cotton-wrapper{column-count:2;text-align:left;}
.cotton-time{font-size:0.7em;margin-left:8px;}
/* Estilos para slide de bingo */
.bingo-slide{font-family:'Comic Sans MS','Comic Sans',cursive;font-weight:bold;}
.bingo-title{font-size:72px;}
.bingo-table{margin:0 auto;border-collapse:collapse;width:100%;}
.bingo-table td{font-size:64px;padding:10px;}
.bingo-table .first-place td{font-size:192px;}
.bingo-table .second-place td{font-size:128px;}

/* Estilos para slide Top Touro */
.bull-slide{font-family:'Comic Sans MS','Comic Sans',cursive;font-weight:bold;}
.bull-title{font-size:72px;}
.bull-table{margin:auto;font-size:64px;border-collapse:collapse;}
.bull-table td{padding:10px 20px;text-align:left;}

/* Estilos para slide de Beer Pong */
.beer-slide{font-family:'Comic Sans MS','Comic Sans',cursive;font-weight:bold;}
.beer-title{font-size:96px;}
.beer-table{margin:auto;font-size:64px;border-collapse:collapse;}
.beer-table td{padding:10px 20px;}

</style>
</head>
<body>
<div id="slides"></div>
<script>
const slidesEl=document.getElementById('slides');
let state={};
let timer;
const bgImages={
  bull:'backgrounds/bull.jpg',
  cotton:'backgrounds/cotton.jpg',
  bingo:'backgrounds/bingo.jpg',
  beer:'backgrounds/beer.jpg',
  pacal:'backgrounds/pacal.jpg',
  attractions:'backgrounds/attractions.jpg',
  score:'backgrounds/score.jpg'
};
function render(){
  clearTimeout(timer);
  slidesEl.innerHTML='';
  const slides=[];
    if(state.bullTimes.length>0){
      const keys=['bullFirst','bullSecond','bullThird','bullFourth','bullFifth'];
      const sorted=[...state.bullTimes].sort((a,b)=>a.time-b.time).slice(0,10);
      let html='<div class="bull-slide">';
      html+='<div class="bull-title">Top Touro</div>';
      html+='<table class="bull-table">';
      for(let row=0; row<5; row++){
        html+='<tr>';
        const left=sorted[row];
        const right=sorted[row+5];
        if(left){
          const pts=row<keys.length?state.points[keys[row]]||0:0;
          html+=`<td>${row+1}. <span class="team-${state.players[left.name]}">${left.name}</span> - ${left.time}s${row<keys.length?` (${pts} pts)`:''} ${row==0?'üèÜ':''}</td>`;
        }else{html+='<td></td>';}
        if(right){
          const idx=row+5;
          html+=`<td>${idx+1}. <span class="team-${state.players[right.name]}">${right.name}</span> - ${right.time}s</td>`;
        }else{html+='<td></td>';}
        html+='</tr>';
      }
      html+='</table></div>';
      slides.push({color:'darkred',image:bgImages.bull,html});
    }
  if(state.cottonWars.length>0){
    const pts = state.points.cottonWin || 0;
    const recent = state.cottonWars.slice().reverse();
    let html='<div class="cotton-slide"><h1>Guerra de Cotonete</h1><div class="cotton-wrapper">';
    recent.forEach(b=>{
      const time=b.time?new Date(b.time).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}):'';
      const trophy1=b.winner===b.p1?'üèÜ':'';
      const trophy2=b.winner===b.p2?'üèÜ':'';
      html+=`<div class="cotton-row"><span class="team-${state.players[b.p1]}">${b.p1}${trophy1}</span> vs <span class="team-${state.players[b.p2]}">${b.p2}${trophy2}</span> (+${pts}) <span class="cotton-time">${time}</span></div>`;
    });
    html+='</div></div>';
    slides.push({color:'green',image:bgImages.cotton,html});
  }
  if(state.bingoWinners){
    let html='<div class="bingo-slide">';
    html+='<div class="bingo-title">Bingo üéâ</div>';
    html+='<table class="bingo-table">';
    const rows=[
      {name:state.bingoWinners.first,key:'bingoFirst',trophy:'üèÜ',pos:'1¬∫'},
      {name:state.bingoWinners.second,key:'bingoSecond',pos:'2¬∫'},
      {name:state.bingoWinners.third,key:'bingoThird',pos:'3¬∫'}
    ];
    rows.forEach((r,i)=>{
      const pts=state.points[r.key]||0;
      const cls=i===0?'first-place':i===1?'second-place':'';
      html+=`<tr class="${cls}"><td>${r.pos} <span class="team-${state.players[r.name]}">${r.name||''}</span> (${pts} pts) ${r.trophy||''}</td></tr>`;
    });
    html+='</table></div>';
    slides.push({color:'purple',image:bgImages.bingo,html});
  }
  if(state.beerPongs.length>0){
    let html='<div class="beer-slide">';
    html+='<div class="beer-title">üç∫ Beer Pong</div>';
    html+='<table class="beer-table">';
    state.beerPongs.slice(-5).forEach(b=>{
      html+=`<tr><td><span class="team-${state.players[b.team1[0]]}">${b.team1[0]}</span></td><td><span class="team-${state.players[b.team2[0]]}">${b.team2[0]}</span></td><td rowspan="2">üèÜ <span class="team-${b.winner}">${state.teamNames[b.winner]}</span></td></tr>`;
      html+=`<tr><td><span class="team-${state.players[b.team1[1]]}">${b.team1[1]}</span></td><td><span class="team-${state.players[b.team2[1]]}">${b.team2[1]}</span></td></tr>`;
    });
    html+='</table></div>';
    slides.push({color:'orange',image:bgImages.beer,html});
  }
  if(state.pacalWars.length>0){
    let html='<h1>Pacal</h1><ul>';
    state.pacalWars.slice(-5).forEach(b=>{html+=`<li><span class="team-${state.players[b.p1]}">${b.p1}</span> vs <span class="team-${state.players[b.p2]}">${b.p2}</span> üèÜ <span class="team-${state.players[b.winner]}">${b.winner}</span></li>`});
    html+='</ul>';
    slides.push({color:'brown',image:bgImages.pacal,html});
  }
  if(state.attractions.length>0){
    const now=new Date();
    const current=state.attractions.find(a=> new Date(a.time)<=now);
    const next=state.attractions.find(a=> new Date(a.time)>now);
    let html='<div class="attractions-slide">';
    html+='<div class="attractions-title">Atra√ß√µes</div>';
    if(current){
      html+=`<div class="attractions-now-label">Agora:</div>`;
      html+=`<div class="attractions-current">${current.name}</div>`;
    }
    if(next){
      const diff=Math.ceil((new Date(next.time)-now)/60000);
      html+=`<div class="attractions-next-label">Em seguida</div>`;
      html+=`<div class="attractions-next">${next.name} <span class="clock">üïí ${diff} min</span></div>`;
    }
    html+='</div>';
    slides.push({color:'blue',image:bgImages.attractions,html});
  }
  const scoreEntries=Object.entries(state.scores).sort((a,b)=>b[1]-a[1]);
  let html='<h1>Placar</h1><ul>';
  scoreEntries.forEach(([team,score],i)=>{html+=`<li>${state.teamNames[team]} - ${score} ${i==0?'üèÜ':''}</li>`});
  html+='</ul>';
  slides.push({color:'black',image:bgImages.score,html});

  slides.forEach((s,i)=>{
    const div=document.createElement('div');
    div.className='slide';
    if(s.color) div.style.backgroundColor=s.color;
    if(s.image) div.style.backgroundImage=`url('${s.image}')`;
    div.innerHTML=s.html;
    slidesEl.appendChild(div);
  });
  let idx=0;
  function show(){
    slidesEl.querySelectorAll('.slide').forEach((el,i)=>{el.classList.toggle('active',i===idx);});
    idx=(idx+1)%slidesEl.children.length;
  }
  function schedule(){
    timer=setTimeout(()=>{show();schedule();},10000);
  }
  slidesEl.onclick=()=>{if(slidesEl.children.length){clearTimeout(timer);show();schedule();}};
  if(slidesEl.children.length>0){show();schedule();}
}

const ws=new WebSocket(`ws://${location.host}`);
ws.onmessage=e=>{state=JSON.parse(e.data);render();};
</script>
</body>
</html>
