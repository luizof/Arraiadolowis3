<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Beer Pong</title>
<style>
body{font-family:sans-serif;padding:20px;}
label{display:block;margin-top:10px;}
</style>
</head>
<body>
<h1>Beer Pong</h1>
<label>Time1 Jogador1 <input id="beerT1P1" list="players"></label>
<label>Time1 Jogador2 <input id="beerT1P2" list="players"></label>
<label>Time2 Jogador1 <input id="beerT2P1" list="players"></label>
<label>Time2 Jogador2 <input id="beerT2P2" list="players"></label>
<label>Vencedor <input id="beerWin" list="players"></label>
<button onclick="addBeer()">Registrar</button>
<datalist id="players"></datalist>
<script>
function post(url,data){fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});}
let players={};
function loadPlayers(){fetch('/api/players').then(r=>r.json()).then(p=>{players=p;playersElem.innerHTML=Object.keys(p).map(n=>`<option value="${n}">`).join('');});}
function askTeam(name){
  return new Promise(resolve=>{
    const overlay=document.createElement('div');
    Object.assign(overlay.style,{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.5)',display:'flex',alignItems:'center',justifyContent:'center'});
    overlay.innerHTML=`<div style="background:white;padding:20px;text-align:center;">
        <p>Selecione o time para ${name}</p>
        <button id="chooseBlue">Azul</button>
        <button id="chooseYellow">Amarelo</button>
      </div>`;
    document.body.appendChild(overlay);
    overlay.querySelector('#chooseBlue').onclick=()=>{done('blue');};
    overlay.querySelector('#chooseYellow').onclick=()=>{done('yellow');};
    function done(team){document.body.removeChild(overlay);resolve(team);}
  });
}
async function ensurePlayer(name){
  if(!name||players[name])return;
  const team=await askTeam(name);
  if(team){post('/api/player',{name,team});players[name]=team;playersElem.innerHTML=Object.keys(players).map(n=>`<option value="${n}">`).join('');}
}
async function addBeer(){for(const n of [beerT1P1.value,beerT1P2.value,beerT2P1.value,beerT2P2.value,beerWin.value]) await ensurePlayer(n);post('/api/beer',{team1:[beerT1P1.value,beerT1P2.value],team2:[beerT2P1.value,beerT2P2.value],winner:beerWin.value});beerT1P1.value='';beerT1P2.value='';beerT2P1.value='';beerT2P2.value='';beerWin.value='';}
const playersElem=document.getElementById('players');
loadPlayers();
</script>
</body>
</html>
