<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Beer Pong</title>
<style>
body{font-family:sans-serif;padding:20px;}
label{display:block;margin-top:10px;}
</style>
</head>
<body>
<h1>Beer Pong</h1>
<label>Jogador1 (Time Azul) <input id="beerBlueP1" list="playersBlue"></label>
<label>Jogador2 (Time Azul) <input id="beerBlueP2" list="playersBlue"></label>
<label>Jogador1 (Time Amarelo) <input id="beerYellowP1" list="playersYellow"></label>
<label>Jogador2 (Time Amarelo) <input id="beerYellowP2" list="playersYellow"></label>
<label>Vencedor <select id="beerWin"></select></label>
<button onclick="addBeer()">Registrar</button>
<datalist id="playersBlue"></datalist>
<datalist id="playersYellow"></datalist>
<script>
function post(url,data){fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});}
let players={};
let teamNames={blue:'Azul',yellow:'Amarelo'};
function loadPlayers(){fetch('/api/players').then(r=>r.json()).then(p=>{players=p;updateLists();});}
function updateLists(){
  const blue=Object.keys(players).filter(n=>players[n]==='blue');
  const yellow=Object.keys(players).filter(n=>players[n]==='yellow');
  playersBlueElem.innerHTML=blue.map(n=>`<option value="${n}">`).join('');
  playersYellowElem.innerHTML=yellow.map(n=>`<option value="${n}">`).join('');
}
function loadTeams(){fetch('/api/state').then(r=>r.json()).then(s=>{teamNames=s.teamNames;beerWin.innerHTML=`<option value="blue">${teamNames.blue}</option><option value="yellow">${teamNames.yellow}</option>`;});}
function ensurePlayer(name,teamHint){if(!name||players[name])return;const team=teamHint||prompt(`Time para ${name}? (blue/yellow)`);if(team){post('/api/player',{name,team});players[name]=team;updateLists();}}
function addBeer(){[beerBlueP1.value,beerBlueP2.value].forEach(n=>ensurePlayer(n,'blue'));[beerYellowP1.value,beerYellowP2.value].forEach(n=>ensurePlayer(n,'yellow'));post('/api/beer',{team1:[beerBlueP1.value,beerBlueP2.value],team2:[beerYellowP1.value,beerYellowP2.value],winner:beerWin.value});beerBlueP1.value='';beerBlueP2.value='';beerYellowP1.value='';beerYellowP2.value='';beerWin.value='';}
const playersBlueElem=document.getElementById('playersBlue');
const playersYellowElem=document.getElementById('playersYellow');
loadPlayers();
loadTeams();
</script>
</body>
</html>
