<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Touro Mecânico</title>
<style>
body{font-family:sans-serif;padding:20px;}
label{display:block;margin-top:10px;}
</style>
</head>
<body>
<h1>Touro Mecânico</h1>
<label>Jogador <input id="bullPlayer" list="players"></label>
<label>Tempo <input id="bullTime" type="number"></label>
<button onclick="addBull()">Registrar</button>
<button id="finishBtn" onclick="confirmFinish()">Finalizar Competição</button>
<button id="newBtn" onclick="newCompetition()" style="display:none">Nova Competição</button>
<datalist id="players"></datalist>
<script>
function post(url,data){fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});}
let players={};
function loadPlayers(){fetch('/api/players').then(r=>r.json()).then(p=>{players=p;playersElem.innerHTML=Object.keys(p).map(n=>`<option value="${n}">`).join('');});}
function ensurePlayer(name){if(!name||players[name])return;const team=prompt(`Time para ${name}? (blue/yellow)`);if(team){post('/api/player',{name,team});players[name]=team;playersElem.innerHTML=Object.keys(players).map(n=>`<option value="${n}">`).join('');}}
function addBull(){ensurePlayer(bullPlayer.value);post('/api/bull',{name:bullPlayer.value,time:bullTime.value});bullPlayer.value='';bullTime.value='';}
const playersElem=document.getElementById('players');
const finishBtn=document.getElementById('finishBtn');
const newBtn=document.getElementById('newBtn');
function confirmFinish(){
  const ans=prompt("Digite 'arraiadolowis' para confirmar");
  if(ans==='arraiadolowis'){post('/api/bull/finish',{});finishBtn.style.display='none';newBtn.style.display='inline';}
}
function newCompetition(){post('/api/bull/new',{});newBtn.style.display='none';finishBtn.style.display='inline';}
function loadState(){fetch('/api/state').then(r=>r.json()).then(s=>{if(s.bullFinished){finishBtn.style.display='none';newBtn.style.display='inline';}});}
loadPlayers();
loadState();
</script>
</body>
</html>
